(()=>{"use strict";var t=$("#comment-form"),a=t.attr("action"),e=function(e,n){t.find('input[name="_method"]').remove(),t.attr("action",a),e.hasClass("active")?(e.removeClass("active"),t.hide(150)):(!n.find("#comment-form").length&&t.appendTo(n),$('.comment-list-wrap button[name="showCommentForm"]').removeClass("active"),$(".comment-list-wrap a.answer-action").removeClass("active"),e.addClass("active"),t.show(150))};$(document).ready((function(){var n,s;if(n=$('textarea[name="message"]'),CKEDITOR.replace(n[0],{language:"uk",removePlugins:"sourcearea",toolbarGroups:[{name:"basicstyles",groups:["basicstyles"]},{name:"paragraph",groups:["list","blocks"]},{name:"styles",groups:["styles"]}],removeButtons:"Underline,Strike,Subscript,Superscript,Anchor,Styles,Specialchar,PasteFromWord"}),$(".comment-list-wrap").on("click",'button[name="showCommentForm"]',(function(){e($(this),$(this).closest(".add-comment-wrap"))})).on("click","a.answer-action",(function(t){t.preventDefault(),e($(this),$(this).closest(".comment-text-wrap").find(".comment-form-wrap"))})).on("click","a.comment-link",(function(a){var e=this;a.preventDefault();var n=$(this).attr("href");void 0!==n&&$.axios.get(n).then((function(a){200===a.status&&(CKEDITOR.instances.message.setData(a.data.message),t.appendTo($(e).closest(".comment-text-wrap").find(".comment-form-wrap")),t.show(150),t.append('<input name="_method" type="hidden" value="patch">'),t.attr("action",a.data.routes.update))}))})).on("click","a.remove-comment-link",(function(t){if(t.preventDefault(),confirm("Ви дійсно хочете видалити цей коментар?")){var a=$(this),e=$(this).attr("href");void 0!==e&&$.axios.delete(e).then((function(t){return 204===t.status&&a.closest(".comment-text-wrap").parent("li").remove()}))}})),t.on("submit",(function(e){e.preventDefault();var n=window.location.pathname,s=new FormData($(this)[0]);s.append("message",CKEDITOR.instances.message.getData()),s.append("parent",$(this).closest("li").attr("data-post")||0),s.append("topic",n.substring(n.lastIndexOf("/")+1));var o=t.find('input[name="_method"]').length>0?$(this).attr("action"):a;$.axios.post(o,s).then((function(a){if(201===a.status){var e=$('.comment-list-wrap li[data-post="'.concat(a.data.parent,'"]'));(e.length?e.children("ul"):$(".comment-list-wrap > ul")).append((n=a.data,'\n<li data-post="'.concat(n.id,'" class="comment-author">\n  <div class="comment-text-wrap">\n    <div class="comment-text">').concat(n.message,'</div>\n    <div class="comment-etc-wrap">\n      <span class="comment-misc" title="Автор коменатря">Написав: ').concat(n.author,'</span>\n      <span class="comment-misc" title="Дата створення коментаря">').concat(n.created,'</span>        \n      <a class="answer-action" href="#" title="Написати відповідь до цього коментаря">Відповісти</a>\n      <a class="comment-link" href="').concat(n.routes.show,'" title="Редагувати коментар"><i class="fas fa-edit"></i></a>\n    </div>\n    <div class="comment-form-wrap"></div>\n  </div>\n  <ul></ul>\n</li>'))),CKEDITOR.instances.message.setData("")}else if(200===a.status){$('.comment-list-wrap li[data-post="'.concat(a.data.id,'"]')).find(".comment-text").html("".concat(a.data.message,'\n          <em\n           title="Редаговано"\n           class="').concat(a.data.author!=a.data.author?"comment-reason":"comment-edited",'"\n          >(ред.)</em>'))}var n;t.hide(150)}))})),window.location.hash){var o=window.location.hash.split("#").filter(String),i=$('li[data-post="'.concat(o[0],'"]'));s=i,$("html").animate({scrollTop:s.offset().top-65},500),o[1]&&"answer"==o[1]&&i.find(" > .comment-text-wrap  .comment-etc-wrap .answer-action").trigger("click")}}))})();